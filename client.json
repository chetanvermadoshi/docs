{
  "openapi": "3.0.0",
  "info": {
    "title": "Doshi Client API",
    "version": "1.0.0",
    "description": "API specification for Doshi client-facing services."
  },
  "servers": [
    {
      "url": "https://api.doshi.app",
      "description": "Production server"
    },
    {
      "url": "https://sandbox.api.doshi.app",
      "description": "Sandbox server"
    }
  ],
  "tags": [
    {
      "name": "Academy",
      "description": "Endpoints related to educational content like courses, lessons, and paths."
    },
    {
      "name": "Auth",
      "description": "Endpoints for user authentication and authorization."
    },
    {
      "name": "Marketplace",
      "description": "Endpoints for rewards and redemptions."
    },
    {
      "name": "User",
      "description": "Endpoints for user data."
    },
    {
      "name": "Quests",
      "description": "Endpoints for quest management."
    }
  ],
  "components": {
    "securitySchemes": {
      "BearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "description": "Authentication token (API Key) provided by Doshi. Your server's IP address must be whitelisted to use this API. Contact hello@doshi.app to whitelist your IPs."
      }
    },
    "parameters": {
      "AccessTypeHeader": {
        "name": "Access-Type",
        "in": "header",
        "required": true,
        "schema": {
          "type": "string",
          "enum": ["client"]
        },
        "description": "Must be set to 'client' for all API requests"
      }
    },
    "schemas": {
      "Error": {
        "type": "object",
        "properties": {
          "code": {
            "type": "string"
          },
          "message": {
            "type": "string"
          },
          "details": {
            "type": "object",
            "additionalProperties": true
          }
        },
        "required": ["code", "message"]
      },
      "SuccessResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          }
        },
        "required": ["success"]
      },
      "GetCustomTokenRequest": {
        "type": "object",
        "properties": {
          "email": {
            "type": "string",
            "format": "email"
          },
          "partnerUserId": {
            "type": "string",
            "minLength": 1,
            "maxLength": 50
          },
          "branchId": {
            "type": "string",
            "minLength": 2,
            "maxLength": 50
          },
          "firstName": {
            "type": "string",
            "minLength": 2,
            "maxLength": 50
          },
          "lastName": {
            "type": "string",
            "minLength": 2,
            "maxLength": 50
          }
        },
        "description": "Request body for generating a custom authentication token. Either email or partnerUserId is required."
      },
      "GetCustomTokenResponse": {
        "type": "object",
        "properties": {
          "token": {
            "type": "string",
            "description": "Firebase authentication token"
          }
        },
        "required": ["token"]
      },
      "Course": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "description": {
            "type": "string"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": ["id", "name"]
      },
      "GetCoursesResponse": {
        "type": "object",
        "properties": {
          "courses": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Course"
            }
          },
          "total": {
            "type": "integer"
          }
        },
        "required": ["courses", "total"]
      },
      "LessonSubmission": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "lessonId": {
            "type": "string"
          },
          "userId": {
            "type": "string"
          },
          "pathId": {
            "type": "string",
            "nullable": true
          },
          "levelId": {
            "type": "string",
            "nullable": true
          },
          "isCompleted": {
            "type": "boolean"
          },
          "completedQuestionIds": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "rightAnsweredQuestionIds": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "rewardedQuestionIds": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "earnedDosh": {
            "type": "number"
          },
          "earnedXP": {
            "type": "number"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time",
            "nullable": true
          },
          "correctAnswers": {
            "type": "number"
          },
          "totalQuestions": {
            "type": "number"
          }
        },
        "required": [
          "id",
          "lessonId",
          "userId",
          "isCompleted",
          "earnedDosh",
          "earnedXP",
          "createdAt",
          "correctAnswers",
          "totalQuestions"
        ]
      },
      "GetLessonSubmissionsResponse": {
        "type": "object",
        "properties": {
          "submissions": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/LessonSubmission"
            }
          },
          "total": {
            "type": "integer"
          }
        },
        "required": ["submissions", "total"]
      },
      "Lesson": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "title": {
            "type": "string"
          },
          "description": {
            "type": "string"
          },
          "locale": {
            "type": "string"
          },
          "content": {
            "type": "array",
            "items": {
              "type": "object"
            }
          }
        },
        "required": ["id", "title"]
      },
      "GetLessonsResponse": {
        "type": "object",
        "properties": {
          "lessons": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Lesson"
            }
          },
          "total": {
            "type": "integer"
          }
        },
        "required": ["lessons", "total"]
      },
      "Path": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "emoji": {
            "type": "string",
            "nullable": true
          },
          "description": {
            "type": "string"
          },
          "contents": {
            "type": "array",
            "items": {
              "type": "object"
            }
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": ["id", "name"]
      },
      "GetPathsResponse": {
        "type": "object",
        "properties": {
          "paths": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Path"
            }
          },
          "total": {
            "type": "integer"
          }
        },
        "required": ["paths", "total"]
      },
      "RedeemedReward": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "delivered": {
            "type": "boolean"
          },
          "status": {
            "type": "string"
          },
          "priceAtPurchase": {
            "type": "number"
          },
          "requireVerification": {
            "type": "boolean"
          },
          "rewardId": {
            "type": "string"
          },
          "rewardType": {
            "type": "string"
          },
          "userId": {
            "type": "string"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time",
            "nullable": true
          }
        },
        "required": [
          "id",
          "delivered",
          "status",
          "priceAtPurchase",
          "requireVerification",
          "rewardId",
          "rewardType",
          "userId",
          "createdAt"
        ]
      },
      "GetRedeemedRewardsResponse": {
        "type": "object",
        "properties": {
          "redeemedRewards": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/RedeemedReward"
            }
          },
          "total": {
            "type": "integer"
          }
        },
        "required": ["redeemedRewards", "total"]
      },
      "Reward": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "description": {
            "type": "string"
          },
          "price": {
            "type": "number"
          },
          "type": {
            "type": "string"
          },
          "brand": {
            "type": "string"
          },
          "imageUrl": {
            "type": "string",
            "format": "uri"
          }
        },
        "required": ["id", "name", "price", "type"]
      },
      "GetRewardsResponse": {
        "type": "object",
        "properties": {
          "rewards": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Reward"
            }
          },
          "total": {
            "type": "integer"
          }
        },
        "required": ["rewards", "total"]
      },
      "User": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "email": {
            "type": "string",
            "format": "email"
          },
          "firstName": {
            "type": "string",
            "nullable": true
          },
          "partnerUserId": {
            "type": "string",
            "nullable": true
          },
          "academyPathId": {
            "type": "string",
            "nullable": true
          },
          "sumsubVerificationResult": {
            "type": "string",
            "nullable": true
          },
          "segmentProgress": {
            "type": "object",
            "additionalProperties": {
              "type": "string"
            },
            "nullable": true
          },
          "branchId": {
            "type": "string",
            "nullable": true
          },
          "platforms": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "nullable": true
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          },
          "xpBalance": {
            "type": "number",
            "nullable": true
          },
          "doshBalance": {
            "type": "number",
            "nullable": true
          },
          "lifeBalance": {
            "type": "number",
            "nullable": true
          }
        },
        "required": ["id", "email", "createdAt", "updatedAt"]
      },
      "GetUsersResponse": {
        "type": "object",
        "properties": {
          "users": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/User"
            }
          },
          "total": {
            "type": "integer"
          }
        },
        "required": ["users", "total"]
      },
      "SubmitQuestRequest": {
        "type": "object",
        "properties": {
          "questId": {
            "type": "string"
          },
          "partnerUserId": {
            "type": "string"
          },
          "reviewStatus": {
            "type": "string",
            "enum": ["APPROVED", "REJECTED"]
          },
          "statusMessage": {
            "type": "string"
          },
          "metadata": {
            "type": "object",
            "additionalProperties": true
          }
        },
        "required": ["questId", "partnerUserId", "reviewStatus", "statusMessage"]
      },
      "SubmitQuestResponse": {
        "type": "object",
        "properties": {
          "isSuccess": {
            "type": "boolean"
          },
          "attemptId": {
            "type": "string"
          }
        },
        "required": ["isSuccess", "attemptId"]
      }
    }
  },
  "security": [
    {
      "BearerAuth": []
    }
  ],
  "paths": {
    "/client/auth/custom-token": {
      "post": {
        "tags": ["Auth"],
        "summary": "Get Custom Authentication Token",
        "description": "Generates a custom Firebase authentication token for a user. Requires either email or partnerUserId. Does not support 2FA/OTP flow.",
        "parameters": [
          {
            "$ref": "#/components/parameters/AccessTypeHeader"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/GetCustomTokenRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successfully generated authentication token.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/GetCustomTokenResponse"
                }
              }
            }
          },
          "default": {
            "description": "Error response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/client/academy/courses": {
      "get": {
        "tags": ["Academy"],
        "summary": "Get Courses",
        "description": "Fetches a list of available courses for the user's institution.",
        "parameters": [
          {
            "$ref": "#/components/parameters/AccessTypeHeader"
          }
        ],
        "responses": {
          "200": {
            "description": "A list of courses.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/GetCoursesResponse"
                }
              }
            }
          },
          "default": {
            "description": "Error response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/client/academy/lesson-submissions": {
      "get": {
        "tags": ["Academy"],
        "summary": "Get Lesson Submissions",
        "description": "Fetches lesson submission data, with optional filters.",
        "parameters": [   
          {
            "$ref": "#/components/parameters/AccessTypeHeader"
          },
          {
            "name": "levelId",
            "in": "query",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "pathId",
            "in": "query",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "lessonId",
            "in": "query",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "A list of lesson submissions.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/GetLessonSubmissionsResponse"
                }
              }
            }
          },
          "default": {
            "description": "Error response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/client/academy/lessons": {
      "get": {
        "tags": ["Academy"],
        "summary": "Get Lessons",
        "description": "Fetches a list of available lessons, including core and institution-specific lessons.",
        "parameters": [
          {
            "$ref": "#/components/parameters/AccessTypeHeader"
          }
        ],
        "responses": {
          "200": {
            "description": "A list of lessons.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/GetLessonsResponse"
                }
              }
            }
          },
          "default": {
            "description": "Error response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/client/academy/paths": {
      "get": {
        "tags": ["Academy"],
        "summary": "Get Paths",
        "description": "Fetches a list of available learning paths for the user's institution.",
        "parameters": [
          {
            "$ref": "#/components/parameters/AccessTypeHeader"
          }
        ],
        "responses": {
          "200": {
            "description": "A list of paths.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/GetPathsResponse"
                }
              }
            }
          },
          "default": {
            "description": "Error response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/client/marketplace/redeemed-rewards": {
      "get": {
        "tags": ["Marketplace"],
        "summary": "Get Redeemed Rewards",
        "description": "Fetches a list of rewards redeemed by users, filterable by userId.",
        "parameters": [  
          {
            "$ref": "#/components/parameters/AccessTypeHeader"
          },
          {
            "name": "userId",
            "in": "query",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "A list of redeemed rewards.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/GetRedeemedRewardsResponse"
                }
              }
            }
          },
          "default": {
            "description": "Error response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/client/marketplace/rewards": {
      "get": {
        "tags": ["Marketplace"],
        "summary": "Get Rewards",
        "description": "Fetches a list of available rewards in the marketplace for the user's institution.",
        "parameters": [
          {
            "$ref": "#/components/parameters/AccessTypeHeader"
          }
        ],
        "responses": {
          "200": {
            "description": "A list of rewards.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/GetRewardsResponse"
                }
              }
            }
          },
          "default": {
            "description": "Error response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/client/quests/submit": {
      "post": {
        "tags": ["Quests"],
        "summary": "Submit Quest Result",
        "description": "Submits a quest result for a user by a partner.",
        "parameters": [
          {
            "$ref": "#/components/parameters/AccessTypeHeader"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SubmitQuestRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Quest submission processed successfully.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SubmitQuestResponse"
                }
              }
            }
          },
          "default": {
            "description": "Error response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/client/users": {
      "get": {
        "tags": ["User"],
        "summary": "Get Users",
        "description": "Fetches a list of users for the institution, optionally filtered by branchId.",
        "parameters": [
          {
            "$ref": "#/components/parameters/AccessTypeHeader"
          },
          {
            "name": "branchId",
            "in": "query",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "A list of users.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/GetUsersResponse"
                }
              }
            }
          },
          "default": {
            "description": "Error response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    }
  }
}